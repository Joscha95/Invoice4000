<template>
<div v-if="store.hasClients" @click="store.newQuote()" class="button black" style="--bg-col:white;"> <span>+</span> </div>

<section v-for="(group, key) in invoicesGrouped" :key="key">
  <div class="sum">{{key}}: {{group.sum.toLocaleString('de-DE')}}E</div>
  <invoices-grid :invoices="group.invoices" :hideAdd="true"/>
</section>

    
</template>

<script setup lang="ts">
import { computed } from 'vue';
import store from '../store'
import invoicesGrid from './subcomponents/invoices-grid.vue' ;


export interface Props {
  groupBy?:number
}

const props = withDefaults(defineProps<Props>(),{
  groupBy:1
})

const invoicesGrouped = computed(()=>{
  
  const m:any = {};

  store.invoices.forEach(i => {
    const k = i.date.split('.')[props.groupBy+1];
    if(m[k]) {
      m[k].invoices.push(i);
      if(!i.quote) m[k].sum+=i.sum;
    } else{
      m[k] = {
        invoices:[i],
        sum: i.quote ? 0 : i.sum 
      }
    }
  });

  return m;
})
</script>

<style scoped>
section{
  margin-bottom: var(--site-padding);
}
.invoices{
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-template-rows: auto;
}
.sum{
  display: inline-block;
  height:2.5em;
  line-height: 2.5em;
  padding: 0 1em;
  box-sizing: border-box;
  background-color: var(--green-sum);
  /* border-radius: 1.5em; */
  font-family: diatype;
  margin: var(--site-padding) 0;
}

.button{
  float: right;
}

</style>